# 開発の歴史

最終更新: 2026-02-26

## 概要

cc-voice-reporter は Claude Code の実行状況を音声でリアルタイムにレポートするツールである。2026年2月中旬に開発が始まり、わずか10日ほどの間に v0.1.0 から v2.2.0 まで急速に進化した。その過程で複数の大きな方針転換があった。

## タイムライン

### フェーズ 1〜4: フックベース時代（〜PR #59、git 履歴外）

現在の git 履歴には含まれていないが（PR #1〜#59 に相当）、プロジェクトは当初 **Claude Code のフック機構** を利用してツール実行・通知イベントを音声報告するアーキテクチャで開発されていた。フック方式はイベント駆動でステートレスに動作し、`say` コマンドでツール名や通知を読み上げていた。

この時期にナレーションモード（Claude のテキスト応答の逐次読み上げ）や翻訳機能なども実装されていた。

### 方針転換 1: transcript .jsonl 監視への移行（2026-02-15 調査、〜PR #60）

**最大の方針転換**。フック方式では Claude のテキスト応答（方針説明、判断理由、結果報告など）が取得できないという根本的な制約があった。

2026-02-15 に技術調査（`.ai-agent/surveys/20260215-transcript-jsonl-watcher/`）を実施し、3つのアプローチを比較検討した結果、`~/.claude/projects/` 配下の transcript .jsonl ファイルをリアルタイム監視する方式への全面移行を決定した。

この決定の意義:
- **Claude の全出力にアクセス可能になった**（フックでは不可能だった）
- ステートレスなフックスクリプトから **常駐デーモン** へのアーキテクチャ転換
- 競合ツールがすべてフック方式を採用する中、**独自の差別化ポイント** を確立
- chokidar v5 + 自前 tail ロジックという技術スタックを採用

### フェーズ 5 前半: 機能充実期（2026-02-21、PR #60〜#79）

transcript 監視ベースのアーキテクチャ上で、1日の間に大量の機能が実装された:

- **多言語ナレーション対応** と Summarizer のストーリー性追加（PR #60, #63）
- **Logger の DI 統一**（PR #64）
- **ESLint を npm workspace に分離**（PR #65）

### 方針転換 2: ナレーションモード・翻訳機能の削除（PR #69）

Issue #68 を受けて、**ナレーションモード（逐次読み上げ）と翻訳機能を完全に削除** し、サマリモード（Ollama による定期要約）のみに簡素化した。これにより:
- 冗長な逐次読み上げを廃止し、要約による効率的な音声レポートに集約
- コードベースが大幅にシンプルになった

### 方針転換 3: Ollama の必須化（PR #75）

当初 Ollama はオプション機能だったが、サマリモードのみに簡素化した結果、**Ollama を動作に必須** とする方針に転換した。同時に CLI リファクタリング（config/logger の移動、tsup 導入、Ollama モデル自動解決）を実施。

### 方針転換 4: パッケージ統合（PR #77）

一時期は CLI と Monitor を別パッケージに分離していたが（PR #73 で CLI サブコマンド導入）、**単一パッケージに再統合** した。分離のオーバーヘッドがメリットを上回ると判断された。

### フェーズ 5 後半: UX 改善とクロスプラットフォーム対応（2026-02-22〜23、PR #84〜#97）

- **TTS コマンド自動フォールバック**: say → espeak-ng → espeak の順で自動検出（PR #87）
- **システムロケールからの言語自動検出**（PR #88）
- **多言語メッセージ対応**（PR #74）
- **対話式設定ウィザード** `config init`（PR #97）
- 要約プロンプト改善、AskUserQuestion の読み上げ順序改善など

### npm 公開と v1.0.0（2026-02-23、PR #99〜#108）

- npm パッケージ公開の CI ワークフロー整備（PR #99）
- v0.2.0 → v0.3.0 と段階的にリリースし、**v1.0.0 として正式公開**（PR #108）

### 方針転換 5: フック機能の追加・削除・再実装（PR #119〜#131）

最も紆余曲折があった機能:

1. **追加**（PR #119, #120）: hook-receiver コマンドを実装し、Claude Code Hooks 経由でパーミッション確認プロンプトを音声通知。config init でフックを自動登録する機能も追加
2. **削除**（PR #126）: hook パーミッション案内機能と config init でのフック登録機能を削除。一度作った機能を取り下げた
3. **再実装**（PR #131）: 通知優先度システムを設計した上で、hook ベースのパーミッション確認通知を再実装。セッション通知状態を SessionState に統合

この経緯は、フック連携の設計が一度では固まらず、通知の優先度やセッション管理との統合を経て安定した設計に至ったことを示している。

### v2.0.0〜v2.2.0: 安定化と品質改善（2026-02-24、PR #121〜#133）

- **v2.0.0**: Claude Code Hooks 連携の正式導入（メジャーバージョンアップ）
- 要約プロンプトのイベント数に二段階制限を追加（PR #125）
- summarizer.ts を責務ごとに3ファイルに分割
- セッション通知のキャンセル機構統一（cancelTag ベース）（PR #132）
- daemon.ts を機能モジュールに分割し単体テスト追加
- **v2.2.0** が現在の最新リリース

## 方針転換のまとめ

| # | 転換内容 | 理由 | 影響度 |
|---|---------|------|--------|
| 1 | フック方式 → transcript .jsonl 監視 | Claude のテキスト応答が取得できない制約を解消 | **最大** |
| 2 | ナレーション+翻訳 → サマリモードのみ | 冗長な逐次読み上げより要約が効率的 | 大 |
| 3 | Ollama オプション → 必須 | サマリモード一本化に伴い要約エンジンが必須に | 中 |
| 4 | CLI/Monitor 分離 → 単一パッケージ | 分離のオーバーヘッドがメリットを上回る | 中 |
| 5 | フック通知の追加→削除→再実装 | 通知優先度設計の試行錯誤を経て安定化 | 中 |

## 開発の特徴

- **非常に高速な開発サイクル**: 4日間で PR #60〜#133（約70件の PR）を消化
- **レビュー駆動**: 多くの PR でレビュー指摘対応のコミットが存在し、品質を担保
- **ドキュメント重視**: steering ドキュメントを主要な変更のたびに更新
- **技術調査先行**: 大きな方針転換の前に調査ドキュメント（survey）を作成
